<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Source Services | Open Build Service</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><meta name="book-title" content="Open Build Service" /><meta name="chapter-title" content="Chapter 8. Source Services" /><link rel="home" href="index.html" title="Open Build Service" /><link rel="up" href="index.html" title="Open Build Service" /><link rel="prev" href="cha.obs.build_config.html" title="Chapter 7. Build Configuration" /><link rel="next" href="cha.obs.signing.html" title="Chapter 9. Signing" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  if (agent.indexOf('android') != -1 && agent.indexOf('chrom') != -1 ) {
      file = 'fonts-nolocal.css';
  }
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script></head><body class="offline js-off"><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="Open Build Service"><span class="book-icon">Open Build Service</span></a><span> › </span><a class="crumb" href="cha.obs.source_service.html">Source Services</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Open Build Service</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="pr01.html"><span class="number"> </span><span class="name">About this Guide</span></a></li><li class="inactive"><a href="cha.obs.motivation.html"><span class="number">1 </span><span class="name">Distributing Free Software: Herding Cats</span></a></li><li class="inactive"><a href="cha.obs.concepts.html"><span class="number">2 </span><span class="name">OBS Concepts</span></a></li><li class="inactive"><a href="cha.obs.build_process.html"><span class="number">3 </span><span class="name">Build Process</span></a></li><li class="inactive"><a href="cha.obs.source_management.html"><span class="number">4 </span><span class="name">Source Management</span></a></li><li class="inactive"><a href="cha.obs.request_and_review_ystem.html"><span class="number">5 </span><span class="name">Request And Review System</span></a></li><li class="inactive"><a href="cha.obs.package_formats.html"><span class="number">6 </span><span class="name">Package Formats</span></a></li><li class="inactive"><a href="cha.obs.build_config.html"><span class="number">7 </span><span class="name">Build Configuration</span></a></li><li class="inactive"><a href="cha.obs.source_service.html"><span class="number">8 </span><span class="name">Source Services</span></a></li><li class="inactive"><a href="cha.obs.signing.html"><span class="number">9 </span><span class="name">Signing</span></a></li><li class="inactive"><a href="cha.obs.product_building.html"><span class="number">10 </span><span class="name">Product Building</span></a></li><li class="inactive"><a href="cha.obs.maintenance_setup.html"><span class="number">11 </span><span class="name">Maintenance Support</span></a></li><li class="inactive"><a href="cha.obs.binary_tracking.html"><span class="number">12 </span><span class="name">Binary Package Tracking</span></a></li><li class="inactive"><a href="cha.obs.cross_arch_build.html"><span class="number">13 </span><span class="name">Cross Architecture Build</span></a></li><li class="inactive"><a href="cha.obs.admin.html"><span class="number">14 </span><span class="name">Administration</span></a></li><li class="inactive"><a href="cha.obs.build_scheduling_and_dispatching.html"><span class="number">15 </span><span class="name">Scheduling and Dispatching</span></a></li><li class="inactive"><a href="cha.obs.build_job_constraints.html"><span class="number">16 </span><span class="name">Build Job Constraints</span></a></li><li class="inactive"><a href="cha.obs.build_preinstall.html"><span class="number">17 </span><span class="name">Build Preinstall Images</span></a></li><li class="inactive"><a href="cha.obs.authorization.token.html"><span class="number">18 </span><span class="name">Authorization</span></a></li><li class="inactive"><a href="cha.obs.qa_hooks.html"><span class="number">19 </span><span class="name">Quality Assurance(QA) Hooks</span></a></li><li class="inactive"><a href="cha.obs.factory.html"><span class="number">20 </span><span class="name">openSUSE Factory</span></a></li><li class="inactive"><a href="go01.html"><span class="number"> </span><span class="name">Glossary</span></a></li><li class="inactive"><a href="appendix.work_on_obs_book.html"><span class="number">A </span><span class="name">How to work on this Book</span></a></li><li class="inactive"><a href="apb.html"><span class="number">B </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 7. Build Configuration" href="cha.obs.build_config.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 9. Signing" href="cha.obs.signing.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="Open Build Service"><span class="book-icon">Open Build Service</span></a><span> › </span><a class="crumb" href="cha.obs.source_service.html">Source Services</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 7. Build Configuration" href="cha.obs.build_config.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 9. Signing" href="cha.obs.signing.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class=""><div class="documentation"><div class="chapter " id="cha.obs.source_service"><div class="titlepage"><div><div><h1 class="title"><span class="number">8 </span><span class="name">Source Services</span> </h1></div></div></div><div class="line"><div class="toc"><dl><dt><span class="section"><a href="cha.obs.source_service.html#idm139812037915408"><span class="number">8.1 </span><span class="name">Using services for validation</span></a></span></dt><dt><span class="section"><a href="cha.obs.source_service.html#idm139812038966544"><span class="number">8.2 </span><span class="name">Different Modes when using services</span></a></span></dt><dt><span class="section"><a href="cha.obs.source_service.html#idm139812038890880"><span class="number">8.3 </span><span class="name">How are source service definitions stored</span></a></span></dt><dt><span class="section"><a href="cha.obs.source_service.html#idm139812038776896"><span class="number">8.4 </span><span class="name">Dropping a source service again</span></a></span></dt><dt><span class="section"><a href="cha.obs.source_service.html#idm139812038774320"><span class="number">8.5 </span><span class="name">How to write a source service</span></a></span></dt><dt><span class="section"><a href="cha.obs.source_service.html#idm139812038772816"><span class="number">8.6 </span><span class="name">Interfaces for using source services</span></a></span></dt></dl></div></div><p>
  Source Services are tools to validate, generate or modify sources in a
  trustable way. They are designed as smallest possible tools and can be
  combined following the powerful idea of the classic UNIX design.
 </p><p>
  Design goals of source services were:
 </p><div class="itemizedlist "><ul class="itemizedlist"><li class="listitem ">
     server side generated files must be easy to identify and must not be modifiable by the user. 
     This way others user can trust them to be generated in the documented way without modifications.
    </li><li class="listitem ">
     generated files must never create merge conflicts
    </li><li class="listitem ">
     generated files must be a separate commit to the user change
    </li><li class="listitem ">
     services must be runnable at any time without user commit
    </li><li class="listitem ">
     services must be runnable on server and client side in the same way
    </li><li class="listitem ">
     services must be designed in a safe way. A source checkout and service run must never harm the system of a user.
    </li><li class="listitem ">
     services shall be designed in a way to avoid unnecessary commits. This means there shall be no time-dependent
     changes. In case the package already contains the same file, the newly generated file must be dropped.
    </li><li class="listitem ">
     local services can be added and used by everybody.
    </li><li class="listitem ">
     server side services must be installed by the admin of the OBS server.
    </li><li class="listitem ">
     service can be defined per package or project wide.
    </li></ul></div><div class="section " id="idm139812037915408"><div class="titlepage"><div><div><h2 class="title" id="idm139812037915408"><span class="number">8.1 </span><span class="name">Using services for validation</span> <a title="Permalink" class="permalink" href="cha.obs.source_service.html#idm139812037915408">#</a></h2></div></div></div><p>
   Source Services may be used to validate sources. This can happen per
   package, which is useful when the packager wants to validate that
   downloaded sources are really from the original maintainer. Or validation
   can happen for an entire project to apply general policies. These
   services can't get skipped in any package
  </p><p>
   Validation can happen by validating files (for example using the
   <code class="command">verify_file</code> or <code class="command">source_validator</code>
   service. These services just fail in the error case which leads to the
   build state "broken". Or validation can happen by redoing a certain
   action and store the result as new file as
   <code class="command">download_files</code> is doing. In this case the newly
   generated file will be used instead of the committed one during build.
  </p></div><div class="section " id="idm139812038966544"><div class="titlepage"><div><div><h2 class="title" id="idm139812038966544"><span class="number">8.2 </span><span class="name">Different Modes when using services</span> <a title="Permalink" class="permalink" href="cha.obs.source_service.html#idm139812038966544">#</a></h2></div></div></div><p>
   Each service can be used in a special mode defining when it should run
   and how to use the result. This can be done per package or globally for
   an entire project.
  </p><div class="section " id="idm139812038965056"><div class="titlepage"><div><div><h3 class="title" id="idm139812038965056"><span class="number">8.2.1 </span><span class="name">Default Mode</span> <a title="Permalink" class="permalink" href="cha.obs.source_service.html#idm139812038965056">#</a></h3></div></div></div><p>
    The default mode of a service is to always run after each commit on the
    server side and locally before every local build.
   </p></div><div class="section " id="idm139812038963456"><div class="titlepage"><div><div><h3 class="title" id="idm139812038963456"><span class="number">8.2.2 </span><span class="name">trylocal Mode</span> <a title="Permalink" class="permalink" href="cha.obs.source_service.html#idm139812038963456">#</a></h3></div></div></div><p>
    The trylocal mode is running the service locally when using current osc
    versions. The result gets committed as standard files and not named with
    _service: prefix. Additionally the service runs on the server by
    default, but usually the service should detect that the result is the
    same and skip the generated files. In case they differ for any reason
    (because the webui or api was used for example) they get generated and
    added on the server.
   </p></div><div class="section " id="idm139812038062816"><div class="titlepage"><div><div><h3 class="title" id="idm139812038062816"><span class="number">8.2.3 </span><span class="name">localonly Mode</span> <a title="Permalink" class="permalink" href="cha.obs.source_service.html#idm139812038062816">#</a></h3></div></div></div><p>
    The localonly mode is running the service locally when using current osc
    versions. The result gets committed as standard files and not named with
    _service: prefix. The service is never running on the server side. It is
    also not possible to trigger it manually.
   </p></div><div class="section " id="idm139812038061056"><div class="titlepage"><div><div><h3 class="title" id="idm139812038061056"><span class="number">8.2.4 </span><span class="name">serveronly Mode</span> <a title="Permalink" class="permalink" href="cha.obs.source_service.html#idm139812038061056">#</a></h3></div></div></div><p>
    The serviceonly mode is running the service on the service only. This
    can be usefull, when the service is not available or can not work on
    developer workstations.
   </p></div><div class="section " id="idm139812038059408"><div class="titlepage"><div><div><h3 class="title" id="idm139812038059408"><span class="number">8.2.5 </span><span class="name">buildtime Mode</span> <a title="Permalink" class="permalink" href="cha.obs.source_service.html#idm139812038059408">#</a></h3></div></div></div><p>
    The service is running inside of the build job, for local and server
    side builds. A side effect is that the service package is becoming a
    build dependency and must be available. Every user can provide and use a
    service this way in their projects. The generated sources are not part
    of the source repository, but part of the generated source packages.
    Network access is not be available when the workers are running in a
    secure mode.
   </p></div><div class="section " id="idm139812038057472"><div class="titlepage"><div><div><h3 class="title" id="idm139812038057472"><span class="number">8.2.6 </span><span class="name">disabled Mode</span> <a title="Permalink" class="permalink" href="cha.obs.source_service.html#idm139812038057472">#</a></h3></div></div></div><p>
    The disabled mode is neither running the service locally or on the
    server side. It can be used to temporarily disable the service but
    keeping the definition as part of the service definition. Or it can be
    used to define the way how to generate the sources and doing so by
    manually calling
</p><div class="verbatim-wrap"><pre class="screen"><code class="command">osc service disabledrun</code></pre></div><p>
    The result will get committed as standard files again.
   </p></div></div><div class="section " id="idm139812038890880"><div class="titlepage"><div><div><h2 class="title" id="idm139812038890880"><span class="number">8.3 </span><span class="name">How are source service definitions stored</span> <a title="Permalink" class="permalink" href="cha.obs.source_service.html#idm139812038890880">#</a></h2></div></div></div><p>
   The called services are always defined in a <code class="command">_service</code>
   file. It is either part of the package sources or used project-wide when
   stored inside the <code class="command">_project</code> package.
  </p><p>
   The _service file contains a list of services which get called in this
   order. Each service may define a list of parameters and a mode. The
   project wide services get called after the per package defined services.
   The _service file is an xml file like this example:
</p><div class="verbatim-wrap"><pre class="screen"><code class="command">
&lt;services&gt;
  &lt;service name="download_files" mode="trylocal" /&gt;
  &lt;service name="verify_file"&gt;
    &lt;param name="file"&gt;krabber-1.0.tar.gz&lt;/param&gt;
    &lt;param name="verifier"&gt;sha256&lt;/param&gt;
    &lt;param name="checksum"&gt;7f535a96a834b31ba2201a90c4d365990785dead92be02d4cf846713be938b78&lt;/param&gt;
  &lt;/service&gt;
  &lt;service name="update_source" mode="disabled" /&gt;
&lt;/services&gt;
        </code></pre></div><p>
   This example downloads the files via download_files service via the given
   URLs from the spec file. When using osc this file gets committed as part
   of the commit. Afterwards the krabber-1.0.tar.gz file will always be
   compared with the sha256 checksum. And last but not least there is the
   <code class="command">update_source</code> service mentioned, which is usually not
   executed. Except when <code class="command">osc service disabledrun</code> is
   called, which will try to upgrade the package to a newer source version
   available online.
  </p></div><div class="section " id="idm139812038776896"><div class="titlepage"><div><div><h2 class="title" id="idm139812038776896"><span class="number">8.4 </span><span class="name">Dropping a source service again</span> <a title="Permalink" class="permalink" href="cha.obs.source_service.html#idm139812038776896">#</a></h2></div></div></div><p>
    Sometimes it is useful to continued to work on generated files manualy. 
    In this situation the _service file needs to be dropped, but all generated
    files need to be commited as standard files. The OBS provides the "mergeservice"
    command for this. It can also be used via osc by calling <code class="command">osc service merge</code>.
  </p></div><div class="section " id="idm139812038774320"><div class="titlepage"><div><div><h2 class="title" id="idm139812038774320"><span class="number">8.5 </span><span class="name">How to write a source service</span> <a title="Permalink" class="permalink" href="cha.obs.source_service.html#idm139812038774320">#</a></h2></div></div></div><p>
   ..
  </p></div><div class="section " id="idm139812038772816"><div class="titlepage"><div><div><h2 class="title" id="idm139812038772816"><span class="number">8.6 </span><span class="name">Interfaces for using source services</span> <a title="Permalink" class="permalink" href="cha.obs.source_service.html#idm139812038772816">#</a></h2></div></div></div><p>
   ..
  </p></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha.obs.signing.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 9 </span>Signing</span></a><a class="nav-link" href="cha.obs.build_config.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 7 </span>Build Configuration</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span><span class="spacer"> • </span><span id="_share-mail" class="bottom-button">E-Mail</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2016 
        SUSE</p><ul><li><a href="http://www.suse.com/company/careers/" target="_top">Careers</a></li><li><a href="http://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="http://www.suse.com/company/" target="_top">About</a></li><li><a href="http://www.suse.com/ContactsOffices/contacts_offices.jsp" target="_top">Contact Us</a></li></ul></div></div></body></html>