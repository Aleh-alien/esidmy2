<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>OBS Architecture | Open Build Service</title><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" /><link rel="stylesheet" type="text/css" href="static/css/style.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><meta name="book-title" content="Open Build Service" /><meta name="chapter-title" content="Chapter 2. OBS Architecture" /><link rel="home" href="index.html" title="Open Build Service" /><link rel="up" href="index.html" title="Open Build Service" /><link rel="prev" href="cha.obs.motivation.html" title="Chapter 1. Distributing Free Software: Herding Cats" /><link rel="next" href="cha.obs.concepts.html" title="Chapter 3. OBS Concepts" /><script type="text/javascript">

var protocol = window.location.protocol.toLowerCase();
if ( protocol != 'file:' ) {
  var agent = navigator.userAgent.toLowerCase();
  var wanted = ( protocol == 'https:') ? 'https' : 'http';
  var file = 'fonts.css';
  if (agent.indexOf('android') != -1 && agent.indexOf('chrom') != -1 ) {
      file = 'fonts-nolocal.css';
  }
  document.write('<link rel="stylesheet" type="text/css" href="' + wanted + '://static.opensuse.org/fonts/'+ file +'"></link>');
}
else {
   document.write('<link rel="stylesheet" type="text/css" href="static/css/fonts-onlylocal.css"></link>');
}

</script><noscript><link rel="stylesheet" type="text/css" href="http://static.opensuse.org/fonts/fonts.css" /></noscript><script src="static/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="static/js/script.js" type="text/javascript"></script></head><body class="offline js-off"><div id="_outer-wrap"><div id="_white-bg"><div id="_header"><div id="_logo"><img src="static/images/logo.png" alt="Logo" /></div><div class="crumbs"><a class="book-link" href="index.html" title="Open Build Service"><span class="book-icon">Open Build Service</span></a><span> › </span><a class="crumb" href="cha.obs.architecture.html">OBS Architecture</a></div><div class="clearme"></div></div></div><div id="_toolbar-wrap"><div id="_toolbar"><div id="_toc-area" class="inactive"><a id="_toc-area-button" class="tool" title="Contents" accesskey="c" href="index.html"><span class="tool-spacer"><span class="toc-icon">Contents</span><span class="clearme"></span></span><span class="tool-label">Contents</span></a><div class="active-contents bubble-corner"></div><div class="active-contents bubble"><div class="bubble-container"><h6>Open Build Service</h6><div id="_bubble-toc"><ol><li class="inactive"><a href="pr01.html"><span class="number"> </span><span class="name">About this Guide</span></a></li><li class="inactive"><a href="cha.obs.motivation.html"><span class="number">1 </span><span class="name">Distributing Free Software: Herding Cats</span></a></li><li class="inactive"><a href="cha.obs.architecture.html"><span class="number">2 </span><span class="name">OBS Architecture</span></a></li><li class="inactive"><a href="cha.obs.concepts.html"><span class="number">3 </span><span class="name">OBS Concepts</span></a></li><li class="inactive"><a href="cha.obs.build_process.html"><span class="number">4 </span><span class="name">Build Process</span></a></li><li class="inactive"><a href="cha.obs.build_containers.html"><span class="number">5 </span><span class="name">Build Containers</span></a></li><li class="inactive"><a href="cha.obs.source_management.html"><span class="number">6 </span><span class="name">Source Management</span></a></li><li class="inactive"><a href="cha.obs.request_and_review_ystem.html"><span class="number">7 </span><span class="name">Request And Review System</span></a></li><li class="inactive"><a href="cha.obs.package_formats.html"><span class="number">8 </span><span class="name">Package Formats</span></a></li><li class="inactive"><a href="cha.obs.image_templates.html"><span class="number">9 </span><span class="name">Image templates</span></a></li><li class="inactive"><a href="cha.obs.build_config.html"><span class="number">10 </span><span class="name">Build Configuration</span></a></li><li class="inactive"><a href="cha.obs.source_service.html"><span class="number">11 </span><span class="name">Source Services</span></a></li><li class="inactive"><a href="cha.obs.multibuild.html"><span class="number">12 </span><span class="name">Multiple Build Description File Handling</span></a></li><li class="inactive"><a href="cha.obs.signing.html"><span class="number">13 </span><span class="name">Signing</span></a></li><li class="inactive"><a href="cha.obs.product_building.html"><span class="number">14 </span><span class="name">Product Building</span></a></li><li class="inactive"><a href="cha.obs.maintenance_setup.html"><span class="number">15 </span><span class="name">Maintenance Support</span></a></li><li class="inactive"><a href="cha.obs.binary_tracking.html"><span class="number">16 </span><span class="name">Binary Package Tracking</span></a></li><li class="inactive"><a href="cha.obs.cross_arch_build.html"><span class="number">17 </span><span class="name">Cross Architecture Build</span></a></li><li class="inactive"><a href="cha.obs.admin.html"><span class="number">18 </span><span class="name">Administration</span></a></li><li class="inactive"><a href="cha.obs.build_scheduling_and_dispatching.html"><span class="number">19 </span><span class="name">Scheduling and Dispatching</span></a></li><li class="inactive"><a href="cha.obs.build_job_constraints.html"><span class="number">20 </span><span class="name">Build Job Constraints</span></a></li><li class="inactive"><a href="cha.obs.build_preinstall.html"><span class="number">21 </span><span class="name">Build Preinstall Images</span></a></li><li class="inactive"><a href="cha.obs.authorization.token.html"><span class="number">22 </span><span class="name">Authorization</span></a></li><li class="inactive"><a href="cha.obs.qa_hooks.html"><span class="number">23 </span><span class="name">Quality Assurance(QA) Hooks</span></a></li><li class="inactive"><a href="cha.obs.factory.html"><span class="number">24 </span><span class="name">openSUSE Factory</span></a></li><li class="inactive"><a href="go01.html"><span class="number"> </span><span class="name">Glossary</span></a></li><li class="inactive"><a href="appendix.work_on_obs_book.html"><span class="number">A </span><span class="name">How to work on this Book</span></a></li><li class="inactive"><a href="apb.html"><span class="number">B </span><span class="name">GNU Licenses</span></a></li></ol></div><div class="clearme"></div></div></div></div><div id="_nav-area" class="inactive"><div class="tool"><span class="nav-inner"><span class="tool-label">Navigation</span><a accesskey="p" class="tool-spacer" title="Chapter 1. Distributing Free Software: Herding Cats" href="cha.obs.motivation.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 3. OBS Concepts" href="cha.obs.concepts.html"><span class="next-icon">→</span></a></span></div></div></div></div><div id="_fixed-header-wrap" class="inactive"><div id="_fixed-header"><div class="crumbs"><a class="book-link" href="index.html" title="Open Build Service"><span class="book-icon">Open Build Service</span></a><span> › </span><a class="crumb" href="cha.obs.architecture.html">OBS Architecture</a></div><div class="buttons"><a class="top-button button" href="#">Top</a><div class="button"><a accesskey="p" class="tool-spacer" title="Chapter 1. Distributing Free Software: Herding Cats" href="cha.obs.motivation.html"><span class="prev-icon">←</span></a><a accesskey="n" class="tool-spacer" title="Chapter 3. OBS Concepts" href="cha.obs.concepts.html"><span class="next-icon">→</span></a></div><div class="clearme"></div></div><div class="clearme"></div></div></div><div id="_content" class=""><div class="documentation"><div class="chapter " id="cha.obs.architecture"><div class="titlepage"><div><div><h1 class="title"><span class="number">2 </span><span class="name">OBS Architecture</span> </h1></div></div></div><div class="line"><div class="toc"><dl><dt><span class="section"><a href="cha.obs.architecture.html#_overview_graph"><span class="number">2.1 </span><span class="name">Overview graph</span></a></span></dt><dt><span class="section"><a href="cha.obs.architecture.html#_backend_components"><span class="number">2.2 </span><span class="name">Backend Components</span></a></span></dt><dt><span class="section"><a href="cha.obs.architecture.html#_communication_flow"><span class="number">2.3 </span><span class="name">Communication flow</span></a></span></dt></dl></div></div><p></p><div class="section " id="_overview_graph"><div class="titlepage"><div><div><h2 class="title" id="_overview_graph"><span class="number">2.1 </span><span class="name">Overview graph</span> <a title="Permalink" class="permalink" href="cha.obs.architecture.html#_overview_graph">#</a></h2></div></div></div><p>
   The OBS is not a monolithic server; it consists of multiple daemons that
   fulfill different tasks.
  </p><div class="figure" id="idm140600270310496"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/obs_components.png"><img src="images/obs_components.png" width="" alt="Simplified OBS Component Overview" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 2.1: </span><span class="name">Simplified OBS Component Overview </span><a title="Permalink" class="permalink" href="cha.obs.architecture.html#idm140600270310496">#</a></h6></div></div></div><div class="section " id="_backend_components"><div class="titlepage"><div><div><h2 class="title" id="_backend_components"><span class="number">2.2 </span><span class="name">Backend Components</span> <a title="Permalink" class="permalink" href="cha.obs.architecture.html#_backend_components">#</a></h2></div></div></div><p>
  The OBS Backend is a collection of Perl applications that manage the source
  files and build jobs of the OBS.
 </p><div class="section " id="_source_server"><div class="titlepage"><div><div><h3 class="title" id="_source_server"><span class="number">2.2.1 </span><span class="name">Source server</span> <a title="Permalink" class="permalink" href="cha.obs.architecture.html#_source_server">#</a></h3></div></div></div><p>
   Maintains the source repository and project/package configurations. It
   provides an HTTP interface, which is the only interface for the Frontend and
   It may forward requests to further backend services.
  </p><p>
   The Source Server keeps track of all sources that are available for
   building. It takes care of file deduplication so that every source file
   is stored just once. This is done by keeping track of the MD5 hashes of
   the files in combination with the filenames. All revisions of
   committed sources are stored and will not be deleted. This guarantees the
   ability to get the source for every delivered binary package.
  </p><p>
   Each OBS installation has one Source Server only. It maintains the
   "sources", "trees" and "projects" directories.
  </p></div><div class="section " id="_repository_server"><div class="titlepage"><div><div><h3 class="title" id="_repository_server"><span class="number">2.2.2 </span><span class="name">Repository server</span> <a title="Permalink" class="permalink" href="cha.obs.architecture.html#_repository_server">#</a></h3></div></div></div><p>
   A repository server provides access to the binaries via an HTTP interface. It
   is used by the frontend via the source server only. Workers use the
   server for registration, requesting the needed binaries for the build jobs
   and storing the result. Notifications for schedulers are also created by
   repository servers. Each OBS installation has at least one repository
   server. A larger installation using partitioning has one on each partition.
  </p></div><div class="section " id="_scheduler"><div class="titlepage"><div><div><h3 class="title" id="_scheduler"><span class="number">2.2.3 </span><span class="name">Scheduler</span> <a title="Permalink" class="permalink" href="cha.obs.architecture.html#_scheduler">#</a></h3></div></div></div><p>
   A scheduler calculates the need for build jobs. It detects changes in
   sources, project configurations or in binaries used in the build
   environment. It is responsible for starting jobs in the right order and
   integrating the built binary packages. Each OBS installation has one
   scheduler per available architecture and partition. It maintains the content
   of the "build" directory.
  </p></div><div class="section " id="_dispatcher"><div class="titlepage"><div><div><h3 class="title" id="_dispatcher"><span class="number">2.2.4 </span><span class="name">Dispatcher</span> <a title="Permalink" class="permalink" href="cha.obs.architecture.html#_dispatcher">#</a></h3></div></div></div><p>
   The dispatcher takes a job (created by the scheduler) and assigns it to
   a free worker. It also checks possible build constraints to verify that the
   worker qualifies for the job. It only notifies a worker about a job; the
   worker downloads the needed resources itself afterwards. Each OBS
   installation has one dispatcher per partition, one of which is the
   master dispatcher.
  </p><p>
   The dispatcher tries to assign jobs fairly between the project repositories.
   For this the dispatcher maintains a <span class="strong"><strong>load</strong></span>
   per project repository (similar to the Unix system load) of used build time.
   The dispatcher assigned jobs to build clients from the repository with the
   lowest load (thereby increasing its load). It is possible to tweak this
   mechanism via dispatching priorities assigned to the repositories via the
   <span class="emphasis"><em>/build/<span class="emphasis"><em>dispatchprios</em></span>
   <span class="strong"><strong>API</strong></span></em></span> call or via the
   <span class="strong"><strong>dispatch_adjust</strong></span> map in the BSConfig.pm
   configuration file. See the dispatch priorities in reference guide for
   more details.
  </p></div><div class="section " id="_publisher"><div class="titlepage"><div><div><h3 class="title" id="_publisher"><span class="number">2.2.5 </span><span class="name">Publisher</span> <a title="Permalink" class="permalink" href="cha.obs.architecture.html#_publisher">#</a></h3></div></div></div><p>
   The publisher processes publish events from the scheduler for finished
   repositories. It merges the build result of all architectures into a
   defined directory structure, creates the needed metadata, and may sync it to
   a download server. It maintains the content of the "repos" directory on the
   backend. Each OBS installation has one publisher per partition.
  </p></div><div class="section " id="_signer"><div class="titlepage"><div><div><h3 class="title" id="_signer"><span class="number">2.2.6 </span><span class="name">Signer</span> <a title="Permalink" class="permalink" href="cha.obs.architecture.html#_signer">#</a></h3></div></div></div><p>
   The signer handles signing events and calls an external tool to
   execute the signing. Each OBS installation usually has one signer per
   partition and also on the source server installation.
  </p></div><div class="section " id="_source_service_server"><div class="titlepage"><div><div><h3 class="title" id="_source_service_server"><span class="number">2.2.7 </span><span class="name">Source service server</span> <a title="Permalink" class="permalink" href="cha.obs.architecture.html#_source_service_server">#</a></h3></div></div></div><p>
   The Source Service Server helps to automate processes for
   <span class="strong"><strong>continuous integration</strong></span>. The server can
   call different services for different tasks. It can download sources from
   websites and version control systems such as subversion and git. Services
   can also include working on the source to extract spec-files from archives,
   repacking the archives or adjusting version numbers in spec files. It is also
   often used to enforce policies by running checks. A failed check will
   appear as broken source and blocks a package from building.
  </p><p>
   The Source Service Server is optional and currently only one Source Service
   Server is supported.
  </p></div><div class="section " id="_warden"><div class="titlepage"><div><div><h3 class="title" id="_warden"><span class="number">2.2.8 </span><span class="name">Warden</span> <a title="Permalink" class="permalink" href="cha.obs.architecture.html#_warden">#</a></h3></div></div></div><p>
   The warden monitors the workers and detects crashed or hanging workers.
   Their build jobs will be canceled and restarted on another host. Each
   OBS installation can have one Warden service running on each partition.
  </p></div><div class="section " id="_download_on_demand_updater"><div class="titlepage"><div><div><h3 class="title" id="_download_on_demand_updater"><span class="number">2.2.9 </span><span class="name">Download on Demand Updater (dodup)</span> <a title="Permalink" class="permalink" href="cha.obs.architecture.html#_download_on_demand_updater">#</a></h3></div></div></div><div id="idm140600270948672" class="admonition note"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    Need OBS version 2.7 or later.
   </p></div><p>
   The download on demand updater monitors all external repositories which
   are defined as download on demand resources. It polls for changes in
   the metadata and re-downloads the metadata in case. The scheduler will be
   notified to recalculate the build jobs depending on these repositories
   afterwards. Each OBS installation can have one dodup service running on each
   partition.
  </p></div><div class="section " id="delta_store"><div class="titlepage"><div><div><h3 class="title" id="delta_store"><span class="number">2.2.10 </span><span class="name">Delta Store</span> <a title="Permalink" class="permalink" href="cha.obs.architecture.html#delta_store">#</a></h3></div></div></div><div id="idm140600270849120" class="admonition note"><img class="symbol" alt="Note" title="Note" src="static/images/icon-note.png" /><h6>Note</h6><p>
    Need OBS version 2.7 or later.
   </p></div><p>
   The delta store daemon maintains the deltas in the source storage.
   Multiple obscpio archives can be stored in one deltastore to avoid
   duplication on disk. This service calculates the delta and maintains
   the delta store. Each OBS installation can have one delta store process
   running next to the source server.
  </p></div><div class="section " id="_worker"><div class="titlepage"><div><div><h3 class="title" id="_worker"><span class="number">2.2.11 </span><span class="name">Worker</span> <a title="Permalink" class="permalink" href="cha.obs.architecture.html#_worker">#</a></h3></div></div></div><p>
   The workers register with the repository servers. They receive build jobs from
   the dispatcher. Afterwards they download sources from the source server and the
   needed binaries from the repository server(s). They build the package
   using the build script and send the result back to the repository server.
   A worker can run on the same host as the other services, but most OBS
   installations have dedicated hardware for the workers.
  </p></div></div><div class="section " id="_communication_flow"><div class="titlepage"><div><div><h2 class="title" id="_communication_flow"><span class="number">2.3 </span><span class="name">Communication flow</span> <a title="Permalink" class="permalink" href="cha.obs.architecture.html#_communication_flow">#</a></h2></div></div></div><p>The communication flow can be split into 3 parts:</p><div class="orderedlist "><ol class="orderedlist" type="1"><li class="listitem ">
User to frontend communication
</li><li class="listitem ">
frontend to source server communication
</li><li class="listitem ">
communication between source server and other backend components, in first place the repository servers.
</li></ol></div><p>The user is using the frontend (via tools like <span class="strong"><strong><span class="emphasis"><em>osc</em></span></strong></span>) to communicate with the Open
Build Service. The frontent is providing a web interface and also an api. The frontend is implemented as Ruby on rails
application. All communcation happens via the <span class="strong"><strong><span class="emphasis"><em>http</em></span></strong></span> protocol (normally
encrypted so <span class="strong"><strong><span class="emphasis"><em>https</em></span></strong></span> is used.</p><p>The communication between the frontend and the backend also use the http
protocol, using the backend source server as gateway to most of the other
backend components.</p><p>The figure <a class="xref" href="cha.obs.architecture.html#fig_obs_communication" title="OBS communication">Figure 2.2, “OBS communication”</a> shows the comunication flow between the OBS components if a
a package source (e.g. a _service file) was updated.</p><p>If a source file of a package was updated, the new source file is uploaded
with an HTTP PUT operation to the frontend.
The frontend may ask for authentication (if not already done) and check
the access rights for the user. If everything is OK, the new file will be
send to the backend <span class="strong"><strong><span class="emphasis"><em>Source server</em></span></strong></span>  via an HTTP PUT request as well.
The source server stores the changed source (under revision control) and
check if for this change source service runs are needed. If yes the <span class="strong"><strong><span class="emphasis"><em>Source
Service server</em></span></strong></span> is informed via an HTTP PUT request of the _service file to
run the requested services.</p><p>The <span class="strong"><strong><span class="emphasis"><em>Source  Service server</em></span></strong></span> runs the different source services, e.g download the requested revision from a GIT server.
After running all services it  delivers the final
sources back to the <span class="strong"><strong><span class="emphasis"><em>Source server</em></span></strong></span>, which then store these under revision control
as well.</p><p>The <span class="strong"><strong><span class="emphasis"><em>Source server</em></span></strong></span>  then notifies the <span class="strong"><strong><span class="emphasis"><em>Schedulers</em></span></strong></span> (for each architecture) about the
change of the package via an event.</p><p>The <span class="strong"><strong><span class="emphasis"><em>Scheduler</em></span></strong></span> recalculates the package and project state and if all build requires are solved, a build Job
is created and put in the <span class="strong"><strong><span class="emphasis"><em>Job pool</em></span></strong></span>. The notified <span class="strong"><strong><span class="emphasis"><em>Dispatcher</em></span></strong></span> checks for free worker which
met the build contrains for the job and send the job to the <span class="strong"><strong><span class="emphasis"><em>worker</em></span></strong></span>.</p><div class="figure" id="fig_obs_communication"><div class="figure-contents"><div class="mediaobject"><a xmlns="" href="images/obs_communication.png"><img src="images/obs_communication.png" alt="obs_communication.png" /></a></div><div class="mediaobject"><a xmlns="" href="images/obs_communication_legend.png"><img src="images/obs_communication_legend.png" alt="obs_communication_legend.png" /></a></div></div><div class="figure-title-wrap"><h6 class="figure-title"><span class="number">Figure 2.2: </span><span class="name">OBS communication </span><a title="Permalink" class="permalink" href="cha.obs.architecture.html#fig_obs_communication">#</a></h6></div></div><p>The <span class="strong"><strong><span class="emphasis"><em>Worker</em></span></strong></span> downloads the sources from the <span class="strong"><strong><span class="emphasis"><em>Source server</em></span></strong></span> and all required binary packages from
the <span class="strong"><strong><span class="emphasis"><em>Repo server</em></span></strong></span>. The package then will be built, the worker is monitored by the <span class="strong"><strong><span class="emphasis"><em>warden</em></span></strong></span> service to detect any
worker crashes.</p><p>If the build was finished the build results (which are also contain build logs) the results are uploaded to the <span class="strong"><strong><span class="emphasis"><em>Scheduler</em></span></strong></span>
again and if requested the <span class="strong"><strong><span class="emphasis"><em>Signer</em></span></strong></span> does sign the packages.
The <span class="strong"><strong><span class="emphasis"><em>Scheduler</em></span></strong></span> recalculate the project status if here are more dependent packages to build. If not it informs the <span class="strong"><strong><span class="emphasis"><em>Publisher</em></span></strong></span>
to publish the new build results and create an updated version of the repository.
Th <span class="strong"><strong><span class="emphasis"><em>Publisher</em></span></strong></span> will also request signing of the repository meta data.</p></div></div></div><div class="page-bottom"><div id="_bottom-navigation"><a class="nav-link" href="cha.obs.concepts.html"><span class="next-icon">→</span><span class="nav-label"><span class="number">Chapter 3 </span>OBS Concepts</span></a><a class="nav-link" href="cha.obs.motivation.html"><span class="prev-icon">←</span><span class="nav-label"><span class="number">Chapter 1 </span>Distributing Free Software: Herding Cats</span></a></div><div id="_share-print"><div class="online-contents share"><strong>Share this page: </strong><span class="share-buttons"><span id="_share-fb" class="bottom-button">Facebook</span><span class="spacer"> • </span><span id="_share-gp" class="bottom-button">Google+</span><span class="spacer"> • </span><span id="_share-tw" class="bottom-button">Twitter</span><span class="spacer"> • </span><span id="_share-mail" class="bottom-button">E-Mail</span></span></div><div class="print"><span id="_print-button" class="bottom-button">Print this page</span></div><div class="clearme"></div></div></div></div><div id="_inward"></div></div><div id="_footer-wrap"><div id="_footer"><p>©
        2017 
        SUSE</p><ul><li><a href="http://www.suse.com/company/careers/" target="_top">Careers</a></li><li><a href="http://www.suse.com/company/legal/" target="_top">Legal</a></li><li><a href="http://www.suse.com/company/" target="_top">About</a></li><li><a href="http://www.suse.com/ContactsOffices/contacts_offices.jsp" target="_top">Contact Us</a></li></ul></div></div></body></html>