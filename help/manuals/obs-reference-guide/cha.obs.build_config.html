<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Chapter 7. Build Configuration</title><link rel="stylesheet" type="text/css" href="static/css/susebooks.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="self" href="cha.obs.build_config.html" title="Build Configuration" /><link rel="home" href="index.html" title="Open Build Service" /><link rel="up" href="index.html" title="Open Build Service" /><link rel="previous" href="cha.obs.package_formats.html" title="Chapter 6. Package Formats" /><link rel="next" href="cha.obs.source_service.html" title="Chapter 8. Source Services" /></head><body><div class="navheader"><table width="100%" summary="Navigation header" border="0" class="bctable"><tr><td width="80%"><div class="breadcrumbs"><p><a href="index.html">Open Build Service</a><strong><a accesskey="p" title="Chapter 6. Package Formats" href="cha.obs.package_formats.html"><span>◀</span></a>  <a accesskey="n" title="Chapter 8. Source Services" href="cha.obs.source_service.html"><span>▶</span></a></strong></p></div></td></tr></table></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cha.obs.build_config"></a>Chapter 7. Build Configuration<span class="permalink"><a title="Copy Permalink" href="#cha.obs.build_config">¶</a></span></h2></div></div></div><div class="toc"><p><strong>Contents</strong></p><dl class="toc"><dt><span class="section"><a href="cha.obs.build_config.html#idp1392477740">7.1. Setup a format</a></span></dt><dt><span class="section"><a href="cha.obs.build_config.html#idp1394920796">7.2. Keywords</a></span></dt><dt><span class="section"><a href="cha.obs.build_config.html#idp1393408548">7.3. Conditions</a></span></dt><dt><span class="section"><a href="cha.obs.build_config.html#idp1394235124">7.4. Macro Section</a></span></dt></dl></div><p>The build configuration is needed at least in each base project to define the
        setup of the build system. In addition to that it can be used to handle compatibility
        layers or to switch on or off certain features during the build.</p><p>The build config is reachable via API /source/PROJECT/_config, via <span class="command"><strong>osc meta prjconf</strong></span>
        or via webui via Project Config tab.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp1392477740"></a>7.1. Setup a format<span class="permalink"><a title="Copy Permalink" href="#idp1392477740">¶</a></span></h2></div></div></div><p>The default format in OBS is rpm, other formats need to be specified in prjconf.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp1394920796"></a>7.2. Keywords<span class="permalink"><a title="Copy Permalink" href="#idp1394920796">¶</a></span></h2></div></div></div><p>The build configuration is parsed by OBS in rpm style independend of the used packaging
          format.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1395179628"></a>7.2.1. Required: &lt;PACKAGES&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1395179628">¶</a></span></h3></div></div></div><p>Required lines contain one or more packages which are needed always to start the build.
            When these packages do change a new build of all packages get triggered automatically.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1394734804"></a>7.2.2. Support: &lt;PACKAGES&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1394734804">¶</a></span></h3></div></div></div><p>Support lines contain one or more packages which are needed always to start the build.
            However it is considered that changes in these packages do not affect other builds, therefore
            no builds get triggered automatically.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1393689940"></a>7.2.3. Preinstall: &lt;PACKAGES&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1393689940">¶</a></span></h3></div></div></div><p>Preinstall packages are needed to run the package installation tool. They get unpacked before
            the VM gets started. Included scripts are NOT executed during this phase. However these
            packages will get installed again inside of the VM including script execution.  </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1393968900"></a>7.2.4. Keep: &lt;PACKAGES&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1393968900">¶</a></span></h3></div></div></div><p>The building package does not get installed by default, even when it is required. Keep is overwriting
            this behaviour and lets the old build installed. It is usually needed for most preinstalled packages
            and critical required packages at least.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1392489276"></a>7.2.5. VMInstall: &lt;PACKAGES&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1392489276">¶</a></span></h3></div></div></div><p>VMInstall is like Preinstall, but these packages get only installed when XEN or KVM is used.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1388814236"></a>7.2.6. Runscripts: &lt;PACKAGES&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1388814236">¶</a></span></h3></div></div></div><p>Runscripts defines the scripts of preinstalled packages which needs to be executed directly after
            preinstall phase, before installing the remaining packages.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1392431372"></a>7.2.7. Order: &lt;PACKAGE_A&gt;:&lt;PACKAGE_B&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1392431372">¶</a></span></h3></div></div></div><p>The build script takes care about the installation order if they are defined via PreRequires inside
            of the packages. However, there might be dependency loops (reported during setup of the build system).
            The Order statement can be used then to give a hint where to break the loop. &lt;PACKAGE_A&gt; will
            get installed before &lt;PACKAGE_B&gt;.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1394722692"></a>7.2.8. ExportFilter: &lt;GLOB&gt; &lt;ARCHITECTURES&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1394722692">¶</a></span></h3></div></div></div><p>The export filter can be used to export build results from one architecture to others. This is 
            required when one architecture needs packages from another one to build against.
            The glob must match the resulting binary name of the package. It will export it to all listed
            scheduler architectures. Using a single dot will export it to the architecture which was used
            to build it. So not using a dot there will filter the package.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1394991348"></a>7.2.9. Prefer: &lt;PACKAGES&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1394991348">¶</a></span></h3></div></div></div><p>In case multiple packages could be installed to satisfy a dependency, the OBS server will complain
            about that situation (Unlike like most standard package installation tools, which just pick one).
            This is done to avoid the situation that builds are not reproducable since random packages would get
            used. The Prefer: tag lists packages to be prefered in case a choice exists. When the package name
            is prefixed with a dash, this is a de-prefer.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1393492996"></a>7.2.10. Prefer: &lt;PACKAGE_A&gt;:&lt;PACKAGES&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1393492996">¶</a></span></h3></div></div></div><p>It is possible to define the prefer only when one package is creating the choice error. This package
             must be listed first with a colon.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1393402572"></a>7.2.11. Ignore: &lt;PACKAGES&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1393402572">¶</a></span></h3></div></div></div><p>Ignore can be used to override dependencies. This can be usefull to break dependency cycles in cases
            when a package dependency is only required in installed systems, but not required to build against this
            package.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1393115892"></a>7.2.12. Ignore: &lt;PACKAGE_A&gt;:&lt;PACKAGES&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1393115892">¶</a></span></h3></div></div></div><p>It is possible to define the ignore only for one package. This package must be listed first with a colon.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1393959124"></a>7.2.13. FileProvides: &lt;FILE&gt; &lt;PACKAGE&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1393959124">¶</a></span></h3></div></div></div><p>Required dependendencies to files (instead of package names) are ignore by OBS by default. FileProvides
            can be used to map a file to a certain package name. File needs to have the full path. Keep in mind
            that some publish repository formats do not export filenames or only some of them. So installing
            these packages may not be possible for the user.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1394343148"></a>7.2.14. Substitute: &lt;PACKAGE_A&gt; ;&lt;PACKAGES&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1394343148">¶</a></span></h3></div></div></div><p>It is possible to replace to BuildRequires with other packages. This will have only an affect on direct
            BuildRequired packages, not on indirect required packages.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1392481572"></a>7.2.15. BuildFlags: &lt;FLAG&gt;:&lt;VALUE&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1392481572">¶</a></span></h3></div></div></div><p>To define flags for the build process. This is currently limited to the vmfstype flag, which can be used to define a specific filesystem when building inside of a VM.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1394176420"></a>7.2.16. OptFlags: &lt;TARGET_ARCHITECTURE&gt; &lt;FLAGS&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1394176420">¶</a></span></h3></div></div></div><p>rpm only: Optflags exports compiler flags to the build. They will only have an effect when the spec file
            is using $RPM_OPT_FLAGS. The target architecture may be * to affect all architectures.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1394397604"></a>7.2.17. Target: &lt;TARGET_ARCHITECTURE&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1394397604">¶</a></span></h3></div></div></div><p>rpm only: Defines the target architecture. This can be used to build for i686 on i586 schedulers for example.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1394567964"></a>7.2.18. HostArch: &lt;HOST_ARCHITECTURE&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1394567964">¶</a></span></h3></div></div></div><p>This is used for cross builds via qemu emulation. It defines the host architecture, while the scheduler architecture
            remains the target architecture by default.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1394068420"></a>7.2.19. Repotype: &lt;TYPE&gt; &lt;HINT&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1394068420">¶</a></span></h3></div></div></div><p>Defines the repository format. Valid values are: none, rpm-md(default), rpm-md:deltainfo, rpm-md-legacy, suse, debian, hdlist2, comps.
            To split the debug packages in an own published repository the hint splitdebug:$REPOSIORY_SUFFIX can be used.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1393596900"></a>7.2.20. Binarytype: &lt;TYPE&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1393596900">¶</a></span></h3></div></div></div><p>(OBS 2.4 or later): Overwrite the binary format used to setup the build environment. For example a package with spec build description may use and generate deb packages instead of rpms. In most cases this is not need since the binarytype follows from the Type (the build type) definition.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1395383340"></a>7.2.21. Patterntype: rpm-md ymp: &lt;TYPES&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1395383340">¶</a></span></h3></div></div></div><p>Defines the pattern format. Valid values are: rpm-md(default), ymp.  </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1394643668"></a>7.2.22. Constraint: &lt;SELECTOR&gt; &lt;STRING&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1394643668">¶</a></span></h3></div></div></div><p>(OBS 2.4 or later): Define build constraints for build jobs. The selector is a collon seperated list which gets a string assigned. Please see 
            the build job constraints page for details.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1393948604"></a>7.2.23. BuildFlags<span class="permalink"><a title="Copy Permalink" href="#idp1393948604">¶</a></span></h3></div></div></div><p>The following build flags can be used to define the used build environment.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp1394408100"></a>7.2.23.1. BuildFlags: vmfstype:&lt;fstype&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1394408100">¶</a></span></h4></div></div></div><p>Defines the used file system inside of VM builds. Current supported file system types are: ext2, ext3, ext4, reiserfs, btrfs, xfs</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp1393408548"></a>7.3. Conditions<span class="permalink"><a title="Copy Permalink" href="#idp1393408548">¶</a></span></h2></div></div></div><p>The following conditions can be used to modify the config.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1395438764"></a>7.3.1. %define &lt;KEY&gt; &lt;VALUE&gt;<span class="permalink"><a title="Copy Permalink" href="#idp1395438764">¶</a></span></h3></div></div></div><p>Defines a key with a value. This value can be used in the entire build config by using %{KEY}</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1394102396"></a>7.3.2. %if ... %else ... %endif<span class="permalink"><a title="Copy Permalink" href="#idp1394102396">¶</a></span></h3></div></div></div><p>Lines can become conditional using the rpm syntax. It may test one keys set by define or predefined
            keys (%_project or %_repository).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1392940268"></a>7.3.3. %ifarch &lt;SCHEDULER_ARCHS&gt; ... %else ... %endif<span class="permalink"><a title="Copy Permalink" href="#idp1392940268">¶</a></span></h3></div></div></div><p>Lines can become conditional using the rpm syntax.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp1394202756"></a>7.3.4. %ifnarch &lt;SCHEDULER_ARCHS&gt; ... %else ... %endif<span class="permalink"><a title="Copy Permalink" href="#idp1394202756">¶</a></span></h3></div></div></div><p>Lines can become conditional using the rpm syntax.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp1394235124"></a>7.4. Macro Section<span class="permalink"><a title="Copy Permalink" href="#idp1394235124">¶</a></span></h2></div></div></div><p>The macro section of the build configuration starts behind a Macros: line and is only used on rpm builds. The content
          gets exported to be used by rpmbuild during the build. It can be used to export a define using "%key value" lines.</p></div></div><div class="navfooter"><table width="100%" summary="Navigation footer" border="0" class="bctable"><tr><td width="80%"><div class="breadcrumbs"><p><a href="index.html">Open Build Service</a><strong><a accesskey="p" title="Chapter 6. Package Formats" href="cha.obs.package_formats.html"><span>◀</span></a>  <a accesskey="n" title="Chapter 8. Source Services" href="cha.obs.source_service.html"><span>▶</span></a></strong></p></div></td></tr></table></div></body></html>